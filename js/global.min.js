import{app}from"/js/firebase.js";import{getFirestore,collection,getDoc,getDocs,doc,setDoc,updateDoc,addDoc,query,where}from"https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";const db=getFirestore();import{getAuth,GoogleAuthProvider,signInWithPopup}from"https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";export{updateDoc,doc,db,getDoc,getDocs,collection,setDoc,addDoc,query,where};const provider=new GoogleAuthProvider,auth=getAuth(app);auth.languageCode="pl";const googleAuthButton=document.getElementById("googleAuthButton");googleAuthButton?googleAuthButton.addEventListener("click",googleAuth):console.log("Error with document.getElementById('googleAuthButton')");const personalCabinetButton=document.getElementById("goToPersonalCabinet"),logOutButton=document.getElementById("googleLogOutButton");function googleAuth(){signInWithPopup(auth,provider).then((t=>{sendUserInfoToDB(GoogleAuthProvider.credentialFromResult(t).accessToken,t.user)})).catch((t=>{const o=t.code,e=t.message;console.log("errorCode - ",o),console.log("errorMessage - ",e)}))}function sendUserInfoToDB(t,o){collection(db,"Students");const e=o.uid;localStorage.setItem("userId",e),getDoc(doc(db,"Students",e)).then((t=>{t.data()?(console.log(),localStorage.setItem("snapshot.data",JSON.stringify(t.data())),document.location="personal_cabinet.html"):setDoc(doc(db,"Students",e),{email:o.email,uid:e,photoUrl:o.photoURL,name:"",surname:"",phone:"",fullInfo:!1}).then((()=>{console.log("Send to BD");var t={email:o.email,uid:e,photoUrl:o.photoURL,name:"",surname:"",phone:"",fullInfo:!1};localStorage.setItem("snapshot.data",JSON.stringify(t)),document.location="personal_cabinet.html"}))})).catch((t=>{console.log(t)}))}localStorage.getItem("snapshot.data")?(personalCabinetButton.setAttribute("style","display: block"),logOutButton.setAttribute("style","display: block"),googleAuthButton.setAttribute("style","display: none")):(personalCabinetButton.setAttribute("style","display: none"),logOutButton.setAttribute("style","display: none"),googleAuthButton.setAttribute("style","display: block")),logOutButton.addEventListener("click",(()=>{localStorage.clear(),document.location="/"})),personalCabinetButton.addEventListener("click",(()=>{document.location="/personal_cabinet.html"}));