localStorage.getItem("snapshot.data")||(document.location="/");const userInfo=JSON.parse(localStorage.getItem("snapshot.data")),changePersonalInformation=document.getElementById("personalInformation"),personalInformationForm=document.getElementById("personalInformationForm"),warningList=document.getElementById("warningsList"),addSubject=document.getElementById("addSubject"),personalTimetable=document.getElementById("personalTimetable"),infoPopup=document.getElementById("infoPopup"),infoPopupCloseButton=document.getElementById("infoPopupCloseButton");userInfo.fullInfo?(document.querySelector("select[name='specialization']").setAttribute("disabled",""),downloadInformationFromLocalStorage(),changePersonalInformation.removeAttribute("disabled"),warningList.removeAttribute("disabled"),addSubject.removeAttribute("disabled"),personalTimetable.removeAttribute("disabled")):changePersonalInformation.removeAttribute("disabled");import{updateDoc,doc,getDocs,db,collection}from"/js/global.js";function changeUserInfoInDB(){const e=userInfo.uid;var o=document.querySelector("input[name='name']").value,n=document.querySelector("input[name='surname']").value,t=document.querySelector("input[name='dateBirthday']").value,a=document.querySelector("select[name='specialization']").value,r=document.querySelector("input[name='phone']").value,u=document.querySelector("input[name='imageUrl']").value,l=new Image;l.src=u,l.onload=function(){updateDoc(doc(db,"Students",e),{name:o,surname:n,dateBirthday:t,specialization_id:a,phone:r,photoUrl:u,fullInfo:!0}).then((()=>{userInfo.name=o,userInfo.surname=n,userInfo.dateBirthday=t,userInfo.specialization_id=a,userInfo.phone=r,userInfo.photoUrl=u,userInfo.fullInfo=!0,localStorage.setItem("snapshot.data",JSON.stringify(userInfo)),document.getElementById("userName").innerText=o+" "+n,warningList.removeAttribute("disabled"),addSubject.removeAttribute("disabled"),personalTimetable.removeAttribute("disabled"),closeInfoPopup()}))},l.onerror=function(){alert("Предоставленный URL изображения невалиден. Пожалуйста, проверьте и попробуйте снова.")}}function downloadInformationFromLocalStorage(){document.getElementById("userName").innerText=userInfo.name+" "+userInfo.surname,userInfo.photoUrl&&(document.getElementById("userPhotoUrl").src=userInfo.photoUrl)}function openInfoPopup(){document.querySelector("body").className+=" popup-active",infoPopup.setAttribute("style","display: block")}function closeInfoPopup(){document.querySelector("body").removeAttribute("class"),infoPopup.setAttribute("style","display: none")}function putInfoInFormPersonalInformation_FullInfo(){console.log(userInfo),downloadSpecializationsFromDB().then((e=>{showSpecializationsInList(e),userInfo.specialization_id&&(document.querySelector("select[name='specialization']").value=userInfo.specialization_id)})).catch((e=>{console.log("Error with ",e)})),document.querySelector("input[name='name']").value=userInfo.name,document.querySelector("input[name='surname']").value=userInfo.surname,document.querySelector("input[name='dateBirthday']").value=userInfo.dateBirthday,document.querySelector("input[name='phone']").value=userInfo.phone,document.querySelector("input[name='email']").value=userInfo.email,document.querySelector("input[name='imageUrl']").value=userInfo.photoUrl}function putInfoInFormPersonalInformation_WithoutFullInfo(){console.log("awdawd"),downloadSpecializationsFromDB().then((e=>{showSpecializationsInList(e)})).catch((e=>{console.log("Error with ",e)})),document.querySelector("input[name='email']").value=userInfo.email,document.querySelector("input[name='imageUrl']").value=userInfo.photoUrl}function downloadSpecializationsFromDB(){return new Promise(((e,o)=>{let n=[];getDocs(collection(db,"Specializations")).then((o=>{o.docs.forEach((e=>{n.push({...e.data()})})),e(n)})).catch((e=>{console.log("Error retrieving specializations: ",e),o(e)}))}))}function showSpecializationsInList(e){const o=document.getElementById("specializations");o.innerHTML="",e.forEach((e=>{const n=document.createElement("option");n.value=e.number_specialization,n.textContent=e.spec_name,o.appendChild(n)}))}changePersonalInformation.addEventListener("click",(()=>{openInfoPopup(),console.log(userInfo),console.log(userInfo.fullInfo),userInfo.fullInfo&&putInfoInFormPersonalInformation_FullInfo(),userInfo.fullInfo||putInfoInFormPersonalInformation_WithoutFullInfo()})),personalInformationForm.addEventListener("submit",(e=>{e.preventDefault(),changeUserInfoInDB()})),infoPopupCloseButton.addEventListener("click",closeInfoPopup);